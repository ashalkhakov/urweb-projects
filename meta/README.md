This code is taken from:

http://hg.impredicative.com/meta

